<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="favicon-home.png">
  <link rel="shortcut icon" sizes="192x192" href="favicon-home.png">

  <title>Aboozy Counter</title>
  <link rel="stylesheet" href="./style.css" >
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Afacad:ital,wght@0,400..700;1,400..700&family=MuseoModerno:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
  <div class="paymethod">
    <button onclick="addItem('Cash', 0)"><h5 class="paymethod-list">üíµ Cash</h5></button>
    <button onclick="addItem('Card', 0)"><h5 class="paymethod-list">üí≥ Card</h5></button>
    <button onclick="addItem('Eftpos', 0)"><h5 class="paymethod-list">üì≤ Transfer</h5></button>
  </div>
  <div id="total">Total: $0</div>
  <div class="button-row">
    <button onclick="submitOrder()" class="confirm-btn"> Confirm Order</button>
    <button onclick="resetCurrentOrder()" class="restart-btn">$0</button>
  </div>

  <div class="section">
    <h3>Main Items</h3>
    <div class="buttons">
      <button onclick="addItem('Aboozy Snack', 15)"><h2 class="price">$15</h1> <p class="item-text">Aboozy Snack</p></button>
      <button onclick="addItem('Couple Pack', 28)"><h2 class="price">$28</h2> <p class="item-text">Couple Pack</p></button>
      <button onclick="addItem('Family Feast', 38)"><h2 class="price">$38</h2> <p class="item-text">Family Feast</p></button>
      <button onclick="addItem('Party Platter', 60)"><h2 class="price">$60</h2><p class="item-text">Party Platter</p> </button>
    </div>
  </div>

  <div class="section">
    <h3>‚ûï Add-ons</h3>
    <div class="buttons">
      <button onclick="addItem('Extra 2pc Chicken', 5)"><h2 class="price">üçó $5</h2><p class="item-text">2pc Chicken</p></button>
      <button onclick="addItem('Large Chips', 4)"><h2 class="price">üçü $4</h2> <p class="item-text">Large Chips</p></button>
      <button onclick="addItem('Fresh Slaw', 3)"><h2 class="price">ü•ó $3</h2> <p class="item-text">Fresh Slaw</p></button>
      <button onclick="addItem('Soft Drink', 2.5)"><h2 class="price">ü•§ $2.5</h2> <p class="item-text">Soft Drink</p></button>
      <button onclick="addItem('Extra Sauce', 1)"><h2 class="price">üå∂Ô∏è $1</h2> <p class="item-text">Extra Sauce</p></button>
      <button onclick="addManualItem()" style="display: flex; flex-wrap:wrap; align-items: center; justify-content: center;height:100%;">
          <h2 class="price">$</h2> <input type="text" id="manualPrice" placeholder="Enter price" min="0" step="0.01"/>
          <p class="item-text">Manual</p>
      </button>
    </div>
  </div>

  <h2 style="margin-top:60px;">üìú History</h2>
  <ul id="history"></ul>
  <div class="line"></div>
  <div id="summary"></div>
  <div class="line"></div>
  
  <button onclick="resetHistory()" class="reset-btn">Reset History</button>
  <h1 style="font-family:MuseoModerno, sans-serif; letter-spacing:4px">aboozy</h1>


<script>
  let currentTotal = 0;
  let currentItems = [];
  let currentPayment = "Unknown"; // Default payment method

  function addItem(name, price) {
    if (['Cash','Card','Eftpos'].includes(name)) {
      currentPayment = name;   // Set payment method
      return;
    }
    currentTotal += price;
    currentItems.push(name);
    document.getElementById("total").innerText = `Total: $${currentTotal.toFixed(2)}`;
  }

function addManualItem() {
  const priceInput = document.getElementById("manualPrice").value.trim();
  if (!priceInput) {
    alert("Please enter a price!");
    return;
  }

  const price = parseFloat(priceInput);
  if (isNaN(price) || price <= 0) {
    alert("Price must be a positive number!");
    return;
  }

  let itemName = prompt("Enter item name:", "Manual Item");
  if (!itemName || itemName.trim() === "") itemName = "Manual Item";

  // Store as an object for easier tracking
  const manualItem = { name: itemName, price: price, type: "manual" };

  currentTotal += price;
  currentItems.push(manualItem);

  document.getElementById("total").innerText = `Total: $${currentTotal.toFixed(2)}`;

  // Clear input
  document.getElementById("manualPrice").value = "";
}


  function resetCurrentOrder() {
    currentTotal = 0;
    currentItems = [];
    currentPayment = "Unknown"; // Reset payment method
    document.getElementById("total").innerText = "Total: $0";
  }

function submitOrder() {
  if (currentTotal === 0) return;

  const now = new Date();
  const date = now.toLocaleDateString();  
  const time = now.toLocaleTimeString();  

  // local storage
  let orders = JSON.parse(localStorage.getItem("orders")) || [];
  orders.push({
    items: currentItems,
    total: currentTotal,
    date: date,
    time: time,
    method: currentPayment // Store payment method
  });
  localStorage.setItem("orders", JSON.stringify(orders));

  // google sheet posting
  fetch("https://script.google.com/macros/s/AKfycbw0pszD68eZghOEztDNB8Uaa43yBxpJqMD1TMxJmylcCAy4nAQ1msev-Ktr7u2G2F52/exec", {
    method: "POST",
    body: JSON.stringify({
      date: date,
      time: time,
      items: currentItems,
      total: currentTotal,
      method: currentPayment // Include payment method
      })
  })
  .then(res => res.json())
  .then(data => console.log("Sheet saved:", data))
  .catch(err => console.error("Error sending to Sheet:", err));

  // history rendering
  renderHistory();

  //reset current order
  currentTotal = 0;
  currentItems = [];
  document.getElementById("total").innerText = "Total: $0";
}

function renderHistory() {
  let orders = JSON.parse(localStorage.getItem("orders")) || [];
  let historyEl = document.getElementById("history");
  historyEl.innerHTML = "";

  // Date grouping
  let grouped = {};
  orders.forEach(o => {
    if (!grouped[o.date]) grouped[o.date] = [];
    grouped[o.date].push(o);
  });

  let summaryHTML = "";

  Object.keys(grouped).sort().forEach(date => {
    let dailyOrders = grouped[date];
    historyEl.innerHTML += `<div class="history-date">${date}</div>`;
    dailyOrders.forEach(o => {
      let li = document.createElement("div");
      li.innerText = `${o.time} | ${o.items.join(", ")} = $${o.total.toFixed(2)}`;
      historyEl.appendChild(li);
    });

    // Date summary
    let totalSales = dailyOrders.reduce((sum, o) => sum + o.total, 0);
    let gst = totalSales * (15/115);
    let netSales = totalSales - gst;
    summaryHTML += `
      <div class="summary">
        <strong>${date} Summary:</strong><br>
        Daily total orders: ${dailyOrders.length}<br>
        Total sales: $${totalSales.toFixed(2)}<br>
        GST (15%): $${gst.toFixed(2)}<br>
        Net sales: $${netSales.toFixed(2)}
      </div>
    `;
  });

  document.getElementById("summary").innerHTML = summaryHTML;
}

function resetHistory() {
  localStorage.removeItem("orders");
  renderHistory();
}

renderHistory();
</script>
</body>
</html>