<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="favicon-home.png">
  <link rel="shortcut icon" sizes="192x192" href="favicon-home.png">

  <title>Aboozy Counter</title>
  <link rel="stylesheet" href="./style.css" >
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Afacad:ital,wght@0,400..700;1,400..700&family=MuseoModerno:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
  
<div class="paymethod">
  <div class="paymethod-btn" data-method="Cash">💵 Cash</div>
  <div class="paymethod-btn" data-method="Card">💳 Card</div>
  <div class="paymethod-btn" data-method="Transfer">📲 Transfer</div>
</div>
  <div id="total">Total: $0</div>
  <div class="button-row">
    <button onclick="submitOrder()" class="confirm-btn"> Confirm Order</button>
    <button onclick="resetCurrentOrder()" class="restart-btn">$0</button>
  </div>

  <div class="section">
    <h3>Main Items</h3>
    <div class="buttons">
      <button onclick="addItem('Aboozy Snack', 15)"><h2 class="price">$15</h1> <p class="item-text">Aboozy Snack</p></button>
      <button onclick="addItem('Couple Pack', 28)"><h2 class="price">$28</h2> <p class="item-text">Couple Pack</p></button>
      <button onclick="addItem('Family Feast', 38)"><h2 class="price">$38</h2> <p class="item-text">Family Feast</p></button>
      <button onclick="addItem('Party Platter', 60)"><h2 class="price">$60</h2><p class="item-text">Party Platter</p> </button>
    </div>
  </div>

  <div class="section">
    <h3>➕ Add-ons</h3>
    <div class="buttons">
      <button onclick="addItem('Extra 2pc Chicken', 5)"><h2 class="price">🍗 $5</h2><p class="item-text">2pc Chicken</p></button>
      <button onclick="addItem('Large Chips', 4)"><h2 class="price">🍟 $4</h2> <p class="item-text">Large Chips</p></button>
      <button onclick="addItem('Fresh Slaw', 3)"><h2 class="price">🥗 $3</h2> <p class="item-text">Fresh Slaw</p></button>
      <button onclick="addItem('Soft Drink', 2.5)"><h2 class="price">🥤 $2.5</h2> <p class="item-text">Soft Drink</p></button>
      <button onclick="addItem('Extra Sauce', 1)"><h2 class="price">🌶️ $1</h2> <p class="item-text">Extra Sauce</p></button>
      <button onclick="addManualItem()" style="display: flex; flex-wrap:wrap; align-items: center; justify-content: center;height:100%;">
          <h2 class="price">$</h2> 
          <input type="number" id="manualPrice" placeholder="Enter price" step="0.01" inputmode="decimal" pattern="[0-9]*"/>
          <p class="item-text">Manual</p>
      </button>
    </div>
  </div>

  <h2 style="margin-top:60px;">📜 History</h2>
  <ul id="history"></ul>
  <div class="line"></div>
  <div id="summary"></div>
  <div class="line"></div>
  
  <button onclick="resetHistory()" class="reset-btn">Reset History</button>
  <h1 style="font-family:MuseoModerno, sans-serif; letter-spacing:4px">aboozy</h1>


<script>
let currentTotal = 0;
let currentItems = [];
let currentPayment = "Unknown";

const payButtons = document.querySelectorAll(".paymethod-btn");

let touchHandled = false;

payButtons.forEach(btn => {
  // 모바일 터치 이벤트
  btn.addEventListener("touchstart", e => {
    e.preventDefault(); // 스크롤 막음
    setPayment(btn.dataset.method, btn);
    touchHandled = true;
  }, { passive: false });

  // 클릭 이벤트 (데스크탑 혹은 터치 후 중복 방지)
  btn.addEventListener("click", e => {
    if (!touchHandled) setPayment(btn.dataset.method, btn);
    touchHandled = false;
  });
});

function setPayment(method, btn) {
  currentPayment = method;
  payButtons.forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
}

function addItem(name, price) {
  currentTotal += price;
  currentItems.push({ name, price, type:"item" });
  updateTotal();
}

function addManualItem() {
  const priceInput = document.getElementById("manualPrice").value.trim();
  const price = parseFloat(priceInput);
  if (!isNaN(price) && price > 0) {
    currentItems.push({ name:"Manual Item", price, type:"manual" });
    currentTotal += price;
    updateTotal();
    document.getElementById("manualPrice").value = "";
  }
}

function updateTotal() {
  document.getElementById("total").innerText = `Total: $${currentTotal.toFixed(2)}`;
}

function resetCurrentOrder() {
  currentTotal = 0;
  currentItems = [];
  currentPayment = "Unknown";
  payButtons.forEach(b => b.classList.remove("active"));
  updateTotal();
}

function submitOrder() {
  if(currentTotal === 0) return;

  const now = new Date();
  const orderData = {
    date: now.toLocaleDateString(),
    time: now.toLocaleTimeString(),
    items: currentItems,
    total: currentTotal,
    method: currentPayment
  };

  // 로컬 저장
  let orders = JSON.parse(localStorage.getItem("orders")) || [];
  orders.push(orderData);
  localStorage.setItem("orders", JSON.stringify(orders));

  // Google Apps Script POST
  fetch("https://script.google.com/macros/s/AKfycbx-h6XxCr3zTCpXG7UZuaqPZzNYFlAAmILNmv3KO4ScSGvIzDox6nRDbUDxQHJj9Yg/exec", {
    method:"POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(orderData)
  })
  .then(res => res.json())
  .then(data => console.log("Sheet saved:", data))
  .catch(err => console.error("Error sending to Sheet:", err));

  renderHistory();
  resetCurrentOrder();
}

function renderHistory() {
  const orders = JSON.parse(localStorage.getItem("orders")) || [];
  const historyEl = document.getElementById("history");
  let summaryHTML = "";
  historyEl.innerHTML = "";

  const grouped = {};
  orders.forEach(o => { (grouped[o.date] ||= []).push(o); });

  Object.keys(grouped).sort().forEach(date => {
    historyEl.innerHTML += `<div class="history-date">${date}</div>`;
    grouped[date].forEach(o => {
      const itemsText = o.items.map(i => `${i.name} ($${i.price})`).join(", ");
      const li = document.createElement("div");
      li.innerText = `${o.time} | ${itemsText} = $${o.total.toFixed(2)} | ${o.method}`;
      historyEl.appendChild(li);
    });
    const totalSales = grouped[date].reduce((sum,o) => sum+o.total,0);
    const gst = totalSales*0.15/1.15;
    const net = totalSales-gst;
    summaryHTML += `<div><strong>${date} Summary:</strong> Orders: ${grouped[date].length}, Sales: $${totalSales.toFixed(2)}, GST: $${gst.toFixed(2)}, Net: $${net.toFixed(2)}</div>`;
  });

  document.getElementById("summary").innerHTML = summaryHTML;
}

function resetHistory() {
  localStorage.removeItem("orders");
  renderHistory();
}

// 초기 렌더링
renderHistory();


</script>
</body>
</html>