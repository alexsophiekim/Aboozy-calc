<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aboozy Counter</title>
  <link rel="stylesheet" href="./style.css" >
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Afacad:ital,wght@0,400..700;1,400..700&family=MuseoModerno:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
  <h1 style="font-family:MuseoModerno, sans-serif; letter-spacing:4px">aboozy</h1>
    <div id="total">Total: $0</div>
  <div class="button-row">
    <button onclick="submitOrder()" class="confirm-btn"> Confirm Order</button>
    <button onclick="resetCurrentOrder()" class="restart-btn">$0</button>
  </div>

  <div class="section">
    <h3>Main Items</h3>
    <div class="buttons">
      <button onclick="addItem('Aboozy Snack', 15)"><h2 class="price">$15</h1> <p class="item-text">Aboozy Snack</p></button>
      <button onclick="addItem('Couple Pack', 28)"><h2 class="price">$28</h2> <p class="item-text">Couple Pack</p></button>
      <button onclick="addItem('Family Feast', 38)"><h2 class="price">$38</h2> <p class="item-text">Family Feast</p></button>
      <button onclick="addItem('Party Platter', 60)"><h2 class="price">$60</h2><p class="item-text">Party Platter</p> </button>
    </div>
  </div>

  <div class="section">
    <h3>â• Add-ons</h3>
    <div class="buttons">
      <button onclick="addItem('Extra 2pc Chicken', 5)"><h2 class="price">ğŸ— $5</h2><p class="item-text">2pc Chicken</p></button>
      <button onclick="addItem('Large Chips', 4)"><h2 class="price">ğŸŸ $4</h2> <p class="item-text">Large Chips</p></button>
      <button onclick="addItem('Fresh Slaw', 3)"><h2 class="price">ğŸ¥— $3</h2> <p class="item-text">Fresh Slaw</p></button>
      <button onclick="addItem('Soft Drink', 2.5)"><h2 class="price">ğŸ¥¤ $2.5</h2> <p class="item-text">Soft Drink</p></button>
      <button onclick="addItem('Extra Sauce', 1)"><h2 class="price">ğŸŒ¶ï¸ $1</h2> <p class="item-text">Extra Sauce</p></button>
    </div>
  </div>

  <h2 style="margin-top:60px;">ğŸ“œ History</h2>
  <ul id="history"></ul>
  <div class="line"></div>
  <div id="summary"></div>
  <div class="line"></div>
  <button onclick="resetHistory()" class="reset-btn">Reset History</button>

<script>
  let currentTotal = 0;
  let currentItems = [];

  function addItem(name, price) {
    currentTotal += price;
    currentItems.push(name);
    document.getElementById("total").innerText = `Total: $${currentTotal.toFixed(2)}`;
  }
  function resetCurrentOrder() {
    currentTotal = 0;
    currentItems = [];
    document.getElementById("total").innerText = "Total: $0";
  }
function submitOrder() {
  if (currentTotal === 0) return;

  const now = new Date();
  const date = now.toLocaleDateString();  
  const time = now.toLocaleTimeString();  

  // local storage
  let orders = JSON.parse(localStorage.getItem("orders")) || [];
  orders.push({
    items: currentItems,
    total: currentTotal,
    date: date,
    time: time
  });
  localStorage.setItem("orders", JSON.stringify(orders));

  // google sheet posting
  fetch("https://script.google.com/macros/s/AKfycbyH-Y9_3EMIaKHUgfe2PlvHjGQgcfgNiLhC7C01SXQJJD1Z0vZLPa_RJ9vzJwKG03L7/exec", {
    method: "POST",
    body: JSON.stringify({
      date: date,
      time: time,
      items: currentItems,
      total: currentTotal
    })
  })
  .then(res => res.json())
  .then(data => console.log("Sheet saved:", data))
  .catch(err => console.error("Error sending to Sheet:", err));

  // history rendering
  renderHistory();

  //reset current order
  currentTotal = 0;
  currentItems = [];
  document.getElementById("total").innerText = "Total: $0";
}

function renderHistory() {
  let orders = JSON.parse(localStorage.getItem("orders")) || [];
  let historyEl = document.getElementById("history");
  historyEl.innerHTML = "";

  // Date grouping
  let grouped = {};
  orders.forEach(o => {
    if (!grouped[o.date]) grouped[o.date] = [];
    grouped[o.date].push(o);
  });

  let summaryHTML = "";

  Object.keys(grouped).sort().forEach(date => {
    let dailyOrders = grouped[date];
    historyEl.innerHTML += `<div class="history-date">${date}</div>`;
    dailyOrders.forEach(o => {
      let li = document.createElement("div");
      li.innerText = `${o.time} | ${o.items.join(", ")} = $${o.total.toFixed(2)}`;
      historyEl.appendChild(li);
    });

    // Date summary
    let totalSales = dailyOrders.reduce((sum, o) => sum + o.total, 0);
    let gst = totalSales * (15/115);
    let netSales = totalSales - gst;
    summaryHTML += `
      <div class="summary">
        <strong>${date} Summary:</strong><br>
        Daily total orders: ${dailyOrders.length}<br>
        Total sales: $${totalSales.toFixed(2)}<br>
        GST (15%): $${gst.toFixed(2)}<br>
        Net sales: $${netSales.toFixed(2)}
      </div>
    `;
  });

  document.getElementById("summary").innerHTML = summaryHTML;
}

function resetHistory() {
  localStorage.removeItem("orders");
  renderHistory();
}

renderHistory();
</script>
</body>
</html>