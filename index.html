<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="favicon-home.png">
  <link rel="shortcut icon" sizes="192x192" href="favicon-home.png">

  <title>Aboozy Counter</title>
  <link rel="stylesheet" href="./style.css" >
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Afacad:ital,wght@0,400..700;1,400..700&family=MuseoModerno:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
<div class="paymethod">
  <div class="paymethod-btn" data-method="Cash">💵 Cash</div>
  <div class="paymethod-btn" data-method="Card">💳 Card</div>
  <div class="paymethod-btn" data-method="Transfer">📲 Transfer</div>
</div>
  <div id="total">Total: $0</div>
  <div class="button-row">
    <button onclick="submitOrder()" class="confirm-btn"> Confirm Order</button>
    <button onclick="resetCurrentOrder()" class="restart-btn">$0</button>
  </div>

  <div class="section">
    <h3>Main Items</h3>
    <div class="buttons">
      <button onclick="addItem('Aboozy Snack', 15)"><h2 class="price">$15</h1> <p class="item-text">Aboozy Snack</p></button>
      <button onclick="addItem('Couple Pack', 28)"><h2 class="price">$28</h2> <p class="item-text">Couple Pack</p></button>
      <button onclick="addItem('Family Feast', 38)"><h2 class="price">$38</h2> <p class="item-text">Family Feast</p></button>
      <button onclick="addItem('Party Platter', 60)"><h2 class="price">$60</h2><p class="item-text">Party Platter</p> </button>
    </div>
  </div>

  <div class="section">
    <h3>➕ Add-ons</h3>
    <div class="buttons">
      <button onclick="addItem('Extra 2pc Chicken', 5)"><h2 class="price">🍗 $5</h2><p class="item-text">2pc Chicken</p></button>
      <button onclick="addItem('Large Chips', 4)"><h2 class="price">🍟 $4</h2> <p class="item-text">Large Chips</p></button>
      <button onclick="addItem('Fresh Slaw', 3)"><h2 class="price">🥗 $3</h2> <p class="item-text">Fresh Slaw</p></button>
      <button onclick="addItem('Soft Drink', 2.5)"><h2 class="price">🥤 $2.5</h2> <p class="item-text">Soft Drink</p></button>
      <button onclick="addItem('Extra Sauce', 1)"><h2 class="price">🌶️ $1</h2> <p class="item-text">Extra Sauce</p></button>
      <button onclick="addManualItem()" style="display: flex; flex-wrap:wrap; align-items: center; justify-content: center;height:100%;">
          <h2 class="price">$</h2> 
          <input type="number" id="manualPrice" placeholder="Enter price" step="0.01" inputmode="decimal" pattern="[0-9]*"/>
          <p class="item-text">Manual</p>
      </button>
    </div>
  </div>

  <h2 style="margin-top:60px;">📜 History</h2>
  <ul id="history"></ul>
  <div class="line"></div>
  <div id="summary"></div>
  <div class="line"></div>
  
  <button onclick="resetHistory()" class="reset-btn">Reset History</button>
  <h1 style="font-family:MuseoModerno, sans-serif; letter-spacing:4px">aboozy</h1>


<script>
  let currentTotal = 0;
  let currentItems = [];
  let currentPayment = "Unknown"; // Default payment method
const payButtons = document.querySelectorAll(".paymethod-btn");

payButtons.forEach(btn => {
  btn.addEventListener("click", e => {
    e.preventDefault(); // WebView compatibility
    setPayment(btn.dataset.method, btn);
  });
});

function setPayment(method, btn) {
  currentPayment = method;

  // toggle active class
  payButtons.forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
}


  function addItem(name, price) {
    if (['Cash','Card','Eftpos'].includes(name)) {
      currentPayment = name;   // Set payment method
      return;
    }
    currentTotal += price;
    currentItems.push(name);
    document.getElementById("total").innerText = `Total: $${currentTotal.toFixed(2)}`;
  }
function addManualItem() {
  const priceInput = document.getElementById("manualPrice").value.trim();
  const price = parseFloat(priceInput);

  // Only proceed if input is a valid number greater than 0
  if (!isNaN(price) && price > 0) {
    let itemName = "Manual Item"; // Default name
    const nameInput = document.getElementById("manualName"); // Optional separate input for name
    if (nameInput && nameInput.value.trim() !== "") {
      itemName = nameInput.value.trim();
      nameInput.value = ""; // Clear name input
    }

    const manualItem = { name: itemName, price: price, type: "manual" };
    currentTotal += price;
    currentItems.push(manualItem);

    document.getElementById("total").innerText = `Total: $${currentTotal.toFixed(2)}`;
    document.getElementById("manualPrice").value = ""; // Clear price input
  }
}

  function resetCurrentOrder() {
    currentTotal = 0;
    currentItems = [];
    currentPayment = "Unknown"; // Reset payment method
    document.getElementById("total").innerText = "Total: $0";
  }

function submitOrder() {
  if (currentTotal === 0) return;

  const now = new Date();
  const date = now.toLocaleDateString();  
  const time = now.toLocaleTimeString();  

  // local storage
  let orders = JSON.parse(localStorage.getItem("orders")) || [];
  orders.push({
    items: currentItems,
    total: currentTotal,
    date: date,
    time: time,
    method: currentPayment // Store payment method
  });
  localStorage.setItem("orders", JSON.stringify(orders));

  // google sheet posting
  fetch("https://script.google.com/macros/s/AKfycbw0pszD68eZghOEztDNB8Uaa43yBxpJqMD1TMxJmylcCAy4nAQ1msev-Ktr7u2G2F52/exec", {
    method: "POST",
    body: JSON.stringify({
      date: date,
      time: time,
      items: currentItems,
      total: currentTotal,
      method: currentPayment // Include payment method
      })
  })
  .then(res => res.json())
  .then(data => console.log("Sheet saved:", data))
  .catch(err => console.error("Error sending to Sheet:", err));

  // history rendering
  renderHistory();

  //reset current order
  currentTotal = 0;
  currentItems = [];
  document.getElementById("total").innerText = "Total: $0";
}

function renderHistory() {
  let orders = JSON.parse(localStorage.getItem("orders")) || [];
  let historyEl = document.getElementById("history");
  historyEl.innerHTML = "";

  // Date grouping
  let grouped = {};
  orders.forEach(o => {
    if (!grouped[o.date]) grouped[o.date] = [];
    grouped[o.date].push(o);
  });

  let summaryHTML = "";

  Object.keys(grouped).sort().forEach(date => {
    let dailyOrders = grouped[date];
    historyEl.innerHTML += `<div class="history-date">${date}</div>`;
    dailyOrders.forEach(o => {
      let li = document.createElement("div");
      li.innerText = `${o.time} | ${o.items.join(", ")} = $${o.total.toFixed(2)}`;
      historyEl.appendChild(li);
    });

    // Date summary
    let totalSales = dailyOrders.reduce((sum, o) => sum + o.total, 0);
    let gst = totalSales * (15/115);
    let netSales = totalSales - gst;
    summaryHTML += `
      <div class="summary">
        <strong>${date} Summary:</strong><br>
        Daily total orders: ${dailyOrders.length}<br>
        Total sales: $${totalSales.toFixed(2)}<br>
        GST (15%): $${gst.toFixed(2)}<br>
        Net sales: $${netSales.toFixed(2)}
      </div>
    `;
  });

  document.getElementById("summary").innerHTML = summaryHTML;
}

function resetHistory() {
  localStorage.removeItem("orders");
  renderHistory();
}

renderHistory();
</script>
</body>
</html>